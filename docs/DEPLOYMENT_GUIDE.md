# دليل النشر التفصيلي لمتجر مشكاة

هذا الدليل يوضح كيفية نشر تطبيق متجر مشكاة على منصات الاستضافة. سننشر الواجهة الأمامية على Vercel والخلفية على Render.com.

## الجزء الأول: نشر الخلفية (Backend) على Render.com

### الخطوة 1: إنشاء حساب على Render.com

1. توجه إلى [render.com](https://render.com)
2. قم بالتسجيل باستخدام حساب GitHub أو بريد إلكتروني
3. قم بتأكيد البريد الإلكتروني إذا لزم الأمر

### الخطوة 2: إنشاء خدمة ويب جديدة

1. بعد تسجيل الدخول، انقر على زر "New" في لوحة التحكم
2. اختر "Web Service" من القائمة
3. اضغط على "Build and deploy from a Git repository"
4. اختر طريقة الاستيراد (GitHub أو GitLab) أو استخدم "Deploy from public Git repository" إذا كان المشروع غير موجود على GitHub
   - إذا كان المشروع على GitHub، اتبع الخطوات لمنح Render الوصول إلى المستودع

### الخطوة 3: تكوين خدمة الويب

املأ النموذج بالمعلومات التالية:
- **Name**: mshkat-api (أو أي اسم تفضله)
- **Region**: اختر أقرب منطقة جغرافية لك أو لمستخدميك
- **Branch**: main (أو الفرع الرئيسي الخاص بك)
- **Root Directory**: backend
- **Runtime**: Node
- **Build Command**: npm install
- **Start Command**: node index.js
- **Plan type**: اختر الخطة المجانية (Free)

### الخطوة 4: إعداد متغيرات البيئة

قم بإضافة متغيرات البيئة التالية:
- **NODE_ENV**: production
- **PORT**: 10000 (أو اترك هذا فارغًا واستخدم PORT الافتراضي لـ Render)
- **JWT_SECRET**: قم بإنشاء سلسلة عشوائية آمنة (يمكن استخدام مولد كلمات مرور آمن)

### الخطوة 5: إعداد التخزين المستمر

1. في صفحة إعدادات خدمة الويب، انتقل إلى قسم "Disks"
2. قم بإضافة قرص جديد:
   - **Name**: data
   - **Mount Path**: /opt/render/project/src/backend/data
   - **Size**: 1 GB (أو أكثر حسب احتياجاتك)

### الخطوة 6: نشر الخدمة

1. انقر على زر "Create Web Service"
2. انتظر حتى يكتمل النشر (قد يستغرق بضع دقائق)
3. بعد اكتمال النشر، ستحصل على عنوان URL للخدمة الخاص بك (مثل `https://mshkat-api.onrender.com`)
4. قم بتدوين هذا العنوان، سنحتاج إليه لتكوين الواجهة الأمامية

## الجزء الثاني: نشر الواجهة الأمامية (Frontend) على Vercel

### الخطوة 1: إنشاء حساب على Vercel

1. توجه إلى [vercel.com](https://vercel.com)
2. قم بالتسجيل باستخدام حساب GitHub أو بريد إلكتروني
3. قم بتأكيد البريد الإلكتروني إذا لزم الأمر

### الخطوة 2: تحديث عنوان API في البيئة

قبل النشر، تأكد من تحديث ملف `.env.production` بعنوان API الصحيح:

```bash
REACT_APP_API_URL=https://your-render-api-url.onrender.com/api
SKIP_PREFLIGHT_CHECK=true
GENERATE_SOURCEMAP=false
BROWSER=none
```

استبدل `https://your-render-api-url.onrender.com/api` بعنوان API الذي حصلت عليه من Render.com.

### الخطوة 3: نشر المشروع

#### الطريقة 1: استخدام واجهة الويب Vercel

1. في لوحة التحكم Vercel، انقر على "+ New Project"
2. اختر المستودع أو قم برفع المشروع
3. قم بتكوين المشروع:
   - **Framework Preset**: Create React App
   - **Root Directory**: islamic-gifts-shop
   - **Build Command**: npm run build
   - **Output Directory**: build
4. في قسم "Environment Variables"، أضف:
   - **REACT_APP_API_URL**: https://your-render-api-url.onrender.com/api (استبدله بعنوان API الخاص بك)
   - **SKIP_PREFLIGHT_CHECK**: true
   - **GENERATE_SOURCEMAP**: false
5. انقر على "Deploy"

#### الطريقة 2: استخدام Vercel CLI

1. قم بتثبيت Vercel CLI:
   ```bash
   npm install -g vercel
   ```

2. سجل الدخول إلى Vercel:
   ```bash
   vercel login
   ```

3. انتقل إلى مجلد المشروع وقم بالنشر:
   ```bash
   cd "c:\Users\msii\Desktop\mshkat-stor"
   vercel
   ```

4. اتبع التعليمات التي تظهر:
   - اختر الحساب
   - اختر اسم المشروع
   - اختر `islamic-gifts-shop` كمجلد للمشروع
   - قم بتأكيد الإعدادات الافتراضية (أو قم بتخصيصها حسب الحاجة)
   - أضف متغيرات البيئة المطلوبة

5. انتظر حتى يكتمل النشر

## الجزء الثالث: ربط الواجهة الأمامية والخلفية

### الخطوة 1: اختبار اتصال API

بعد نشر كلا الجزأين، تأكد من أن الواجهة الأمامية يمكنها الاتصال بالواجهة الخلفية:

1. افتح المتصفح وانتقل إلى موقع Vercel الذي تم نشره
2. حاول تسجيل الدخول باستخدام حساب المدير (admin / admin123)
3. تحقق من أنك تستطيع رؤية واستعراض الطلبات في لوحة المدير

### الخطوة 2: اختبار استمرار البيانات

تأكد من أن البيانات تُحفظ بشكل صحيح:

1. قم بإنشاء طلب جديد من واجهة المستخدم
2. تحقق من ظهوره في لوحة المدير
3. قم بتغيير حالة الطلب وتحقق من تحديثه بشكل صحيح

## ملاحظات هامة

1. **النسخ الاحتياطي للبيانات**:
   - قم بإعداد نظام للنسخ الاحتياطي المنتظم لملفات JSON في مجلد البيانات

2. **تخزين الملفات**:
   - للإنتاج، يُفضل استخدام خدمة تخزين سحابية مثل Amazon S3 أو Cloudinary لتخزين الصور وملفات المستخدمين

3. **خدمة قاعدة البيانات**:
   - في المستقبل، يمكن ترقية التطبيق لاستخدام قاعدة بيانات حقيقية بدلاً من ملفات JSON

4. **مراقبة التطبيق**:
   - استخدم لوحة تحكم Render.com و Vercel لمراقبة أداء التطبيق والسجلات

5. **الأمان**:
   - قم بتغيير كلمات المرور الافتراضية
   - تأكد من استخدام HTTPS لجميع الاتصالات

## استكشاف الأخطاء وإصلاحها

### مشاكل الاتصال بين الواجهة الأمامية والخلفية

1. تحقق من متغير البيئة `REACT_APP_API_URL` في إعدادات Vercel
2. تأكد من أن خدمة Render تعمل بشكل صحيح
3. افحص سجلات التطبيق في Render للتعرف على أي مشاكل

### مشاكل CORS

إذا واجهت مشاكل CORS، تأكد من أن الخادم الخلفي يسمح بالطلبات من مجال Vercel:

```javascript
// في ملف backend/index.js
app.use(cors({
  origin: [
    'https://your-vercel-domain.vercel.app',
    'http://localhost:3000'
  ],
  credentials: true
}));
```

### مشاكل البناء

1. افحص سجلات البناء في Vercel أو Render
2. تأكد من وجود جميع التبعيات في ملفات package.json
3. تأكد من تكوين الخطوات الصحيحة للبناء

## الدعم والمساعدة

لمزيد من المساعدة، راجع:
- [توثيق Vercel](https://vercel.com/docs)
- [توثيق Render](https://render.com/docs)
